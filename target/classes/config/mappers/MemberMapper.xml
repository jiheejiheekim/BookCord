<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.book.cord.login.MemberMapper">

    <insert id="insertMember" parameterType="com.book.cord.login.MemberVO">
        INSERT INTO member (id, pwd, name, reg_date, provider) 
        VALUES (#{id}, #{pwd}, #{name}, SYSDATE, 'local')
    </insert>
    
    <resultMap type="com.book.cord.login.MemberVO" id="memberMap">
    	<id property="id" column="id" />
    	<result property="pwd" column="pwd" />
    	<result property="name" column="name" />
    	<result property="member_num" column="member_num" />
    	<result property="provider" column="provider" />
    	<result property="reg_date" column="reg_date" />
    	<collection property="role" ofType="com.book.cord.login.AuthVO" resultMap="authMap" />
    </resultMap>
    
    <resultMap type="com.book.cord.login.AuthVO" id="authMap">
    	<result property="id" column="id" />
    	<result property="auth" column="role" />
    </resultMap>
    
    <select id="read" resultMap="memberMap">
        SELECT m.id, pwd, name, reg_date, r.role 
        FROM member m LEFT OUTER JOIN member_role r 
        ON m.id = r.member_id 
        WHERE m.id = #{id}
    </select>
    
</mapper>
