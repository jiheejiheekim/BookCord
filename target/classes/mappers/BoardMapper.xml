<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.book.cord.board.BoardMapper">

<!-- 공지사항 게시판 -->
	
	<select id="getListWithPaging" resultType="com.book.cord.board.NoticeVO">
		<![CDATA[
	        SELECT 
	            NOTICE_NUM, MEMBER_NAME, TITLE, REG_DATE, HIT
	        FROM (
	            SELECT 
	                ROW_NUMBER() OVER (ORDER BY NOTICE_NUM DESC) AS rnum, NOTICE_NUM, MEMBER_NAME, TITLE, REG_DATE, HIT
	            FROM 
	                NOTICE
	                
	        ) tmp
	        WHERE 
	            rnum BETWEEN #{startRow} AND #{endRow}
	        ORDER BY 
	            rnum ASC
	    ]]>
	</select>
	
	<select id="totalCount" resultType="int">
		SELECT COUNT(*) FROM NOTICE
	</select>
	
	<insert id="insertNotice">
			INSERT INTO NOTICE (NOTICE_NUM, MEMBER_NAME, TITLE, CONTENT, FILES) 
			VALUES (notice_num_seq.nextval, '관리자', #{title}, #{content}, #{files})
	</insert>
	
	<select id="getNoticeDetail" resultType="com.book.cord.board.NoticeVO" parameterType="int">
		SELECT * FROM NOTICE WHERE NOTICE_NUM = #{notice_num}
	</select>
	
	<update id="updateNotice" parameterType="com.book.cord.board.NoticeVO">
		UPDATE NOTICE SET TITLE=#{title}, CONTENT=#{content}, FILES=#{files} 
		WHERE NOTICE_NUM = #{notice_num}
	</update>
	
	<delete id="deleteNotice" parameterType="int">
		DELETE FROM NOTICE WHERE NOTICE_NUM = #{notice_num}
	</delete>
	
	<update id="updateHit" parameterType="int">
		UPDATE NOTICE SET HIT = HIT+1 WHERE NOTICE_NUM = #{notice_num}
	</update>
	
	<select id="getSearchNoticePaging" resultType="com.book.cord.board.NoticeVO" parameterType="map">
    <![CDATA[
        SELECT 
            NOTICE_NUM, MEMBER_ID, TITLE, REG_DATE, HIT, MEMBER_NAME
        FROM (
            SELECT 
                ROW_NUMBER() OVER (ORDER BY NOTICE_NUM DESC) AS rnum, NOTICE_NUM, MEMBER_ID, TITLE, REG_DATE, HIT, MEMBER_NAME
            FROM 
                NOTICE
            WHERE 
                 ${select} LIKE '%' || #{search} || '%'
        ) tmp
        WHERE 
            rnum BETWEEN #{startRow} AND #{endRow}
        ORDER BY 
            rnum ASC
    ]]> 
	</select>
	
	<select id="searchNoticeCount" resultType="int">
		SELECT COUNT(*) FROM NOTICE 
		<where>
            <if test="select != null and select != ''">
                ${select} LIKE '%' || #{search} || '%'
            </if>
        </where>
	</select>
	
<!-- 자유 게시판 -->
	<select id="getFreeBoardListPaging" resultType="com.book.cord.board.FreeBoardVO">
	<!-- SELECT * FROM FREEBOARD -->
		<![CDATA[
	        SELECT 
	            FREEBOARD_NUM, MEMBER_NAME, MEMBER_ID, TITLE, REG_DATE, HIT
	        FROM (
	            SELECT 
	                ROW_NUMBER() OVER (ORDER BY FREEBOARD_NUM DESC) AS rnum, FREEBOARD_NUM, MEMBER_NAME, MEMBER_ID, TITLE, REG_DATE, HIT
	            FROM 
	                FREEBOARD
	            
	        ) tmp
	        WHERE 
	            rnum BETWEEN #{startRow} AND #{endRow}
	        ORDER BY 
	            rnum ASC
	    ]]>
	</select>	
	
	<select id="totalFreeBoardCount" resultType="int">
		SELECT COUNT(*) FROM FREEBOARD
	</select>
	
	<select id="getMemberName" parameterType="string" resultType="com.book.cord.login.MemberVO">
		SELECT NAME FROM MEMBER WHERE ID = #{member_id}
	</select>
	
	<insert id="insertFreeBoard">
		INSERT INTO FREEBOARD
			(FREEBOARD_NUM, MEMBER_NAME, MEMBER_ID, TITLE, CONTENT, FILES) 
		VALUES
			(freeBoard_num_seq.nextval, #{member_name}, #{member_id}, #{title}, #{content}, #{files})
	</insert>
	
	<select id="getFreeBoardDetail" resultType="com.book.cord.board.FreeBoardVO" parameterType="int">
		SELECT * FROM FREEBOARD WHERE FREEBOARD_NUM = #{freeBoard_num}
	</select>
	
	<update id="upFreeBoardHit">
		UPDATE FREEBOARD SET HIT = HIT+1 WHERE FREEBOARD_NUM = #{freeBoard_num}
	</update>
	
	<delete id="deleteFreeBoard">
		DELETE FROM FREEBOARD WHERE FREEBOARD_NUM = #{freeBoard_num}
	</delete>
	
	<update id="updateFreeBoard">
		UPDATE FREEBOARD SET TITLE=#{title}, CONTENT=#{content}, FILES=#{files} 
		WHERE FREEBOARD_NUM = #{freeBoard_num}
	</update>
	
	<select id="getSearchFreeBoardPaging" resultType="com.book.cord.board.FreeBoardVO" parameterType="map">
    <![CDATA[
        SELECT 
            FREEBOARD_NUM, MEMBER_NAME, MEMBER_ID, TITLE, REG_DATE, HIT
        FROM (
            SELECT 
                ROW_NUMBER() OVER (ORDER BY FREEBOARD_NUM DESC) AS rnum, FREEBOARD_NUM, MEMBER_NAME, MEMBER_ID, TITLE, REG_DATE, HIT 
            FROM 
                FREEBOARD
            WHERE 
                 ${select} LIKE '%' || #{search} || '%'
        ) tmp
        WHERE 
            rnum BETWEEN #{startRow} AND #{endRow}
        ORDER BY 
            rnum ASC
    ]]> 
	</select>
	
	<select id="searchFreeBoardCount" resultType="int">
		SELECT COUNT(*) FROM FREEBOARD 
		<where>
            <if test="select != null and select != ''">
                ${select} LIKE '%' || #{search} || '%'
            </if>
        </where>
	</select>
	
</mapper>
