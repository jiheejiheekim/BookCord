<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.book.cord.board.BoardMapper">

<!-- 공지사항 게시판 -->
	
	<select id="getListWithPaging" resultType="com.book.cord.board.NoticeVO">
		<![CDATA[
			SELECT 
				NOTICE_NUM, MEMBER_ID, TITLE, REG_DATE, HIT
			FROM (
				    select  
				    rownum rn, NOTICE_NUM, MEMBER_ID, TITLE, REG_DATE, HIT 
				    from NOTICE
				    where rownum <= #{pageNum} * #{amount} ORDER BY NOTICE_NUM DESC
				)
			WHERE rn > (#{pageNum} - 1) * #{amount} ORDER BY NOTICE_NUM DESC
		]]>
	</select>
	
	<select id="totalCount" resultType="int">
		SELECT COUNT(*) FROM NOTICE
	</select>
	
	<insert id="insertNotice">
			INSERT INTO NOTICE (NOTICE_NUM, MEMBER_ID, TITLE, CONTENT, FILES) 
			VALUES (test_num_seq.nextval, 'admin', #{title}, #{content}, #{files})
	</insert>
	
	<select id="getNoticeDetail" resultType="com.book.cord.board.NoticeVO" parameterType="int">
		SELECT * FROM NOTICE WHERE NOTICE_NUM = #{notice_num}
	</select>
	
	<update id="updateNotice" parameterType="com.book.cord.board.NoticeVO">
		UPDATE NOTICE SET TITLE=#{title}, CONTENT=#{content}, FILES=#{files} 
		WHERE NOTICE_NUM = #{notice_num}
	</update>
	
	<delete id="deleteNotice" parameterType="int">
		DELETE FROM NOTICE WHERE NOTICE_NUM = #{notice_num}
	</delete>
	
	<update id="updateHit" parameterType="int">
		UPDATE NOTICE SET HIT = HIT+1 WHERE NOTICE_NUM = #{notice_num}
	</update>
	
	<select id="getSearchNoticePaging" resultType="com.book.cord.board.NoticeVO" parameterType="map">
    <![CDATA[
        SELECT 
            NOTICE_NUM, MEMBER_ID, TITLE, REG_DATE, HIT
        FROM (
            SELECT 
                ROW_NUMBER() OVER (ORDER BY NOTICE_NUM DESC) AS rnum, NOTICE_NUM, MEMBER_ID, TITLE, REG_DATE, HIT 
            FROM 
                NOTICE
            WHERE 
                 ${select} LIKE '%' || #{search} || '%'
        ) tmp
        WHERE 
            rnum BETWEEN #{startRow} AND #{endRow}
        ORDER BY 
            rnum ASC
    ]]> 
	</select>
	
	<select id="searchCount" resultType="int">
		SELECT COUNT(*) FROM NOTICE 
		<where>
            <if test="select != null and select != ''">
                ${select} LIKE '%' || #{search} || '%'
            </if>
        </where>
	</select>
	
<!-- 자유 게시판 -->
	<select id="getFreeBoardListPaging" resultType="com.book.cord.board.FreeBoardVO">
	<!-- SELECT * FROM FREEBOARD -->
		<![CDATA[
			SELECT 
				FREEBOARD_NUM, MEMBER_NAME, MEMBER_ID, TITLE, REG_DATE, HIT
			FROM (
				    select  
				    rownum rn, FREEBOARD_NUM, MEMBER_NAME, MEMBER_ID, TITLE, REG_DATE, HIT 
				    from FREEBOARD
				    where rownum <= #{pageNum} * #{amount} ORDER BY FREEBOARD_NUM DESC
				)
			WHERE rn > (#{pageNum} - 1) * #{amount} ORDER BY FREEBOARD_NUM DESC
		]]> 
	</select>	
	
	<select id="totalFreeBoardCount" resultType="int">
		SELECT COUNT(*) FROM FREEBOARD
	</select>
	
	<select id="getMemberName" parameterType="string" resultType="com.book.cord.login.MemberVO">
		SELECT NAME FROM MEMBER WHERE ID = #{member_id}
	</select>
	
	<insert id="insertFreeBoard">
		INSERT INTO FREEBOARD
			(FREEBOARD_NUM, MEMBER_NAME, MEMBER_ID, TITLE, CONTENT, FILES) 
		VALUES
			(freeboard_num_seq.nextval, #{member_name}, #{member_id}, #{title}, #{content}, #{files})
	</insert>
	
	<select id="getFreeBoardDetail" resultType="com.book.cord.board.FreeBoardVO" parameterType="int">
		SELECT * FROM FREEBOARD WHERE FREEBOARD_NUM = #{freeboard_num}
	</select>
	
	<update id="upFreeBoardHit">
		UPDATE FREEBOARD SET HIT = HIT+1 WHERE FREEBOARD_NUM = #{freeboard_num}
	</update>
	
</mapper>
