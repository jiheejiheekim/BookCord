<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.book.cord.mypage.MyPageMapper">

<!-- 리뷰 -->
	<insert id="insertReview">
		INSERT INTO REVIEW (REVIEW_NUM, MEMBER_ID, STARS, TITLE, AUTHOR, ISBN13, COVER, CONTENT)
		VALUES (review_num_seq.nextval, #{member_id}, #{stars}, #{title}, #{author}, #{isbn13}, #{cover}, #{content})
	</insert>
    
    <select id="reviewTotalCount" resultType="int">
		SELECT COUNT(*) FROM REVIEW WHERE MEMBER_ID=#{member_id}
	</select>

	<select id="getReviewListPaging" parameterType="map" resultType="com.book.cord.mypage.ReviewVO">
    <![CDATA[
        SELECT 
            REVIEW_NUM, MEMBER_ID, STARS, TITLE, AUTHOR, ISBN13, COVER, CONTENT, REG_DATE
        FROM (
            SELECT 
                rownum rn, REVIEW_NUM, MEMBER_ID, STARS, TITLE, AUTHOR, ISBN13, COVER, CONTENT, REG_DATE
            FROM 
                REVIEW
            WHERE 
                member_id = #{member_id, jdbcType=VARCHAR}
                AND rownum <= #{pageNum} * #{amount}
            ORDER BY 
                REVIEW_NUM DESC
        )
        WHERE 
            rn > (#{pageNum} - 1) * #{amount}
        ORDER BY 
            REVIEW_NUM DESC
    ]]>
	</select>
	
	<update id="updateReview" parameterType="com.book.cord.mypage.ReviewVO">
		UPDATE REVIEW SET STARS=#{stars}, CONTENT=#{content} WHERE REVIEW_NUM=#{review_num}
	</update>


<!-- 북마크 -->
    <insert id="insertBookMark">
        INSERT INTO bookmark (bookmark_num, member_id, title, author, isbn13, cover)
        VALUES (bookmark_num_seq.nextval, #{member_id}, #{title}, #{author}, #{isbn13}, #{cover})
    </insert>
    
    <select id="bookMarkTotalCount" resultType="int">
		SELECT COUNT(*) FROM BOOKMARK WHERE MEMBER_ID=#{member_id}
	</select>

	<select id="getBookMarkListPaging" parameterType="map" resultType="com.book.cord.mypage.BookMarkVO">
    <![CDATA[
        SELECT 
            BOOKMARK_NUM, MEMBER_ID, TITLE, AUTHOR, ISBN13, COVER
        FROM (
            SELECT 
                rownum rn, BOOKMARK_NUM, MEMBER_ID, TITLE, AUTHOR, ISBN13, COVER
            FROM 
                BOOKMARK
            WHERE 
                member_id = #{member_id, jdbcType=VARCHAR}
                AND rownum <= #{pageNum} * #{amount}
            ORDER BY 
                BOOKMARK_NUM DESC
        )
        WHERE 
            rn > (#{pageNum} - 1) * #{amount}
        ORDER BY 
            BOOKMARK_NUM DESC
    ]]>
	</select>

    
</mapper>
